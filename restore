#!/bin/bash
#
# restore - Restore omarchy config overrides from this repo
#
# Use this script after an omarchy update overwrites your custom configs.
# It copies all tracked config files from this repo back to ~/.config/
#
# Usage: ./restore
#

# Exit immediately if any command fails
set -e

# Get the directory where this script lives (the repo root)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# ---------------------------------------------------------------------------
# CONFIG ENTRIES
# ---------------------------------------------------------------------------
# Format: "display_name:repo_subdir:config_subdir"
#
#   display_name  - Human-readable name shown in output
#   repo_subdir   - Subdirectory in this repo containing the config files
#   config_subdir - Subdirectory under ~/.config/ where files should be restored
#
# To add a new config, simply add a new entry to this array.
# Example: "waybar:waybar:waybar" would sync ./waybar/ <-> ~/.config/waybar/
# ---------------------------------------------------------------------------
CONFIGS=(
    "hypr:hypr:hypr"
    "ghostty:ghostty:ghostty"
)

echo "Restoring omarchy overrides..."

# Loop through each config entry and restore files
for entry in "${CONFIGS[@]}"; do
    # Split the entry by ':' into separate variables
    IFS=':' read -r name repo_subdir config_subdir <<< "$entry"
    
    # Only restore if the source directory exists in the repo
    if [ -d "$SCRIPT_DIR/$repo_subdir" ]; then
        # Ensure target directory exists
        mkdir -p ~/.config/"$config_subdir"
        
        # Copy all files recursively from repo to config location
        # The trailing /. ensures we copy contents, not the directory itself
        cp -r "$SCRIPT_DIR/$repo_subdir"/. ~/.config/"$config_subdir"/
        
        echo "  - Restored $name"
    fi
done

# Reload hyprland to apply changes immediately (if it's running)
if command -v hyprctl &> /dev/null && hyprctl monitors &> /dev/null; then
    hyprctl reload
    echo "  - Reloaded hyprland"
fi

echo "Done!"
