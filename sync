#!/bin/bash
#
# sync - Sync current omarchy configs to this repo for version control
#
# Use this script after making changes to your configs in ~/.config/
# It copies your current config files into this repo so you can commit them.
#
# Usage: ./sync
#        git add -A && git commit -m "Update configs" && git push
#

# Exit immediately if any command fails
set -e

# Get the directory where this script lives (the repo root)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# ---------------------------------------------------------------------------
# CONFIG ENTRIES
# ---------------------------------------------------------------------------
# Format: "display_name:repo_subdir:config_subdir"
#
#   display_name  - Human-readable name shown in output
#   repo_subdir   - Subdirectory in this repo where config files are stored
#   config_subdir - Subdirectory under ~/.config/ to sync from
#
# To add a new config, simply add a new entry to this array.
# Example: "waybar:waybar:waybar" would sync ~/.config/waybar/ -> ./waybar/
# ---------------------------------------------------------------------------
CONFIGS=(
    "hypr:hypr:hypr"
    "ghostty:ghostty:ghostty"
)

echo "Syncing omarchy configs to repo..."

# Loop through each config entry and sync files
for entry in "${CONFIGS[@]}"; do
    # Split the entry by ':' into separate variables
    IFS=':' read -r name repo_subdir config_subdir <<< "$entry"
    
    # Only sync if the source directory exists
    if [ -d ~/.config/"$config_subdir" ]; then
        # Ensure target directory exists in repo
        mkdir -p "$SCRIPT_DIR/$repo_subdir"
        
        # Use rsync to copy files:
        #   -a           : Archive mode (preserves permissions, timestamps, etc.)
        #   --exclude    : Skip backup files created by omarchy (*.bak*)
        #   trailing /   : Copy contents, not the directory itself
        rsync -a --exclude='*.bak*' ~/.config/"$config_subdir"/ "$SCRIPT_DIR/$repo_subdir"/
        
        echo "  - Synced $name"
    fi
done

echo "Done! Don't forget to commit and push your changes."
